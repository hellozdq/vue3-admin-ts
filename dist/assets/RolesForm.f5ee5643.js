var e=Object.defineProperty,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(r,l,o)=>l in r?e(r,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[l]=o,a=(e,a)=>{for(var d in a||(a={}))l.call(a,d)&&s(e,d,a[d]);if(r)for(var d of r(a))o.call(a,d)&&s(e,d,a[d]);return e};import{d,s as n,p as t,b as i,r as c,o as p,e as u,f as m,F as f,l as h,k as I,t as v,m as b,w as y,q as g,J as k,C as j,z as C,A as O}from"./vendor.f3ea224c.js";import{u as _,a as F}from"./index.ce160369.js";var R=d({name:"RolesCard",props:{roles:{type:Object,default:{ids:[]}},parentIds:{type:Array,required:!0},parentId:{type:Number,required:!0}},setup:(e,r)=>(n((()=>e.roles.ids),(()=>{})),{})});const U=y();t("data-v-388daf94");const V={class:"item-content"};i();const q=U(((e,r,l,o,s,a)=>{const d=c("el-checkbox"),n=c("roles-card",!0),t=c("el-checkbox-group");return p(),u("div",V,[m(t,{modelValue:e.roles.ids,"onUpdate:modelValue":r[2]||(r[2]=r=>e.roles.ids=r)},{default:U((()=>[(p(!0),u(f,null,h(e.roles.children,((l,o)=>(p(),u("div",{class:["checkCard",l.children?"":"lastItem"],key:l.roleId},[m(d,{label:l.roleId},{default:U((()=>[I(v(l.roleName),1)])),_:2},1032,["label"]),l.children?(p(),u(n,{key:0,roles:e.roles.children[o],"onUpdate:roles":r=>e.roles.children[o]=r,parentIds:e.roles.ids,"onUpdate:parentIds":r[1]||(r[1]=r=>e.roles.ids=r),parentId:l.roleId},null,8,["roles","onUpdate:roles","parentIds","parentId"])):b("",!0)],2)))),128))])),_:1},8,["modelValue"])])}));R.render=q,R.__scopeId="data-v-388daf94";var w=d({name:"RolesForm",props:{userForm:{type:Object,required:!0},dialogRolesVisible:{type:Boolean,required:!0}},components:{RolesCard:R},setup(e,r){const l=g(!1),o=g(!1),s=e=>{let r=e.ids;if(e.children)for(let l in e.children){const o=e.children[l];if(o.children){const e=s(o);r=[...r,...e]}}return r},d=(e.userForm.roles?e.userForm.roles.split(","):[]).map((e=>Number(e)));console.log(d);let n=g([]);o.value=!0,F().then((e=>{o.value=!1;const r=e.data;n.value=t({roleId:0,ids:[],children:r})})).catch((()=>{o.value=!1}));const t=e=>{if(e.children&&(e.ids=[],e.children))for(let r in e.children){const l=a({},e.children[r]);d.includes(l.roleId)&&e.ids.push(l.roleId),e.children[r]=t(l)}return e},i=g([]),c=g(0);return{roles:n,confirm:()=>{const o=s(k(n.value)),a={userId:e.userForm.id,roles:o.join(",")};l.value=!0,_(a).then((()=>{l.value=!1,j.success("修改成功！"),r.emit("update:dialogRolesVisible",!1),r.emit("onSearch")})).catch((()=>{l.value=!1}))},cancel:()=>{r.emit("update:dialogRolesVisible",!1)},roleId:c,ids:i,loading:l,roleLoading:o}}});const x=y();t("data-v-317cec90");const z={class:"roleForm"},N={class:"footer"},P={class:"dialog-footer"},A=I("确 定"),L=I("取 消");i();const S=x(((e,r,l,o,s,a)=>{const d=c("roles-card"),n=c("el-button"),t=C("loading");return O((p(),u("div",null,[m("div",z,[m(d,{roles:e.roles,"onUpdate:roles":r[1]||(r[1]=r=>e.roles=r),parentIds:e.ids,"onUpdate:parentIds":r[2]||(r[2]=r=>e.ids=r),parentId:e.roleId},null,8,["roles","parentIds","parentId"])]),m("div",N,[m("span",P,[m(n,{type:"primary",size:"medium",onClick:e.confirm,loading:e.loading},{default:x((()=>[A])),_:1},8,["onClick","loading"]),m(n,{size:"medium",onClick:e.cancel},{default:x((()=>[L])),_:1},8,["onClick"])])])],512)),[[t,e.roleLoading]])}));w.render=S,w.__scopeId="data-v-317cec90";export default w;
